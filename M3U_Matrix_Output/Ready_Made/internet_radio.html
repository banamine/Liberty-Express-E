<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>ScheduleFlow - Internet Radio Template</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #000000 0%, #000000 100%);
            color: #00ff00;
            padding: 70px 20px 20px;
        }
        
        /* Top Navigation */
        .top-nav-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #000;
            border-bottom: 2px solid #00ff00;
            padding: 15px 20px;
            z-index: 10000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-logo { color: #00ff00; font-weight: bold; font-size: 1.2em; text-decoration: none; }
        .nav-links { display: flex; gap: 15px; flex-wrap: wrap; }
        .nav-links a { color: #ffff00; text-decoration: none; padding: 5px 10px; transition: all 0.3s; }
        .nav-links a:hover { color: #00ff00; }
        
        .container { max-width: 1400px; margin: 0 auto; }
        
        h1 {
            background: linear-gradient(135deg, #00ff00, #ffff00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .subtitle { text-align: center; color: #ffff00; font-size: 1.1em; margin-bottom: 40px; }
        
        .grid { display: grid; grid-template-columns: 1fr 2fr 1fr; gap: 20px; margin-bottom: 30px; }
        
        .card {
            background: rgba(0, 255, 0, 0.05);
            border: 2px solid #00ff00;
            border-radius: 8px;
            padding: 20px;
        }
        
        .card h2 { color: #00ff00; margin-bottom: 15px; font-size: 1.3em; border-bottom: 2px solid #ffff00; padding-bottom: 10px; }
        .card h3 { color: #ffff00; margin: 15px 0 10px; font-size: 0.95em; }
        
        .player-container {
            aspect-ratio: 16/9;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 15px;
            border: 1px solid #00ff00;
        }
        
        audio {
            width: 100%;
            height: 100%;
            background: #000;
        }
        
        textarea, input {
            width: 100%;
            padding: 10px;
            background: #000;
            color: #00ff00;
            border: 1px dashed #00ff00;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        button {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #00ff00, #ffff00);
            color: #000;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 8px;
            transition: all 0.3s;
        }
        
        button:hover { box-shadow: 0 0 15px rgba(0, 255, 0, 0.5); }
        
        .queue-list { background: #1a1a1a; border: 1px solid #00ff00; padding: 15px; border-radius: 6px; max-height: 300px; overflow-y: auto; }
        .queue-item { padding: 8px; margin: 5px 0; background: #000; border-left: 3px solid #ffff00; cursor: pointer; }
        .queue-item:hover { background: rgba(0, 255, 0, 0.1); }
        .queue-item.playing { background: rgba(0, 255, 0, 0.2); border-left-color: #00ff00; }
        
        .stats { background: #1a1a1a; border: 1px solid #00ff00; padding: 15px; border-radius: 6px; margin-bottom: 15px; }
        .stat-line { display: flex; justify-content: space-between; margin: 8px 0; color: #ffff00; }
        .stat-value { color: #00ff00; font-weight: bold; }
        
        .info-box {
            background: rgba(0, 255, 0, 0.05);
            border-left: 4px solid #ffff00;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .rule-item { padding: 8px; margin: 5px 0; background: #000; border-left: 3px solid #00ff00; }
        
        @media (max-width: 1200px) {
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<nav class="top-nav-bar">
    <a href="index.html" class="nav-logo">üé¨ ScheduleFlow</a>
    <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="m3u_scheduler.html">Scheduler</a>
        <a href="file_manager.html">Files</a>
        <a href="FILE_BROWSER_README.html">Docs</a>
        <a href="internet_radio.html" style="color: #00ff00; border-bottom: 2px solid #00ff00;">üéôÔ∏è Internet Radio</a>
    </div>
</nav>

<div class="container">
    <h1>üéôÔ∏è Internet Radio Station Playout</h1>
    <p class="subtitle">24/7 Music Rotation with Smart Balancing & Auto-Scheduling</p>
    
    <div class="grid">
        <!-- LEFT: Music Player -->
        <div class="card">
            <h2>üéµ Now Playing</h2>
            <div class="player-container">
                <audio id="radioPlayer" controls></audio>
            </div>
            
            <h3>Current Track</h3>
            <div id="nowPlaying" style="background: #000; padding: 10px; border-radius: 6px; color: #ffff00; min-height: 50px;">
                <div>Title: <span style="color: #00ff00;">Ready</span></div>
                <div>Category: <span style="color: #00ff00;">-</span></div>
                <div>Duration: <span style="color: #00ff00;">-</span></div>
            </div>
        </div>
        
        <!-- CENTER: Scheduling & Controls -->
        <div class="card">
            <h2>‚è∞ Radio Schedule</h2>
            
            <h3>Load Playlist (M3U/JSON/TXT)</h3>
            <textarea id="playlistInput" placeholder="Paste M3U/JSON or drag file..."></textarea>
            <button onclick="loadPlaylist()">üì• Load Music List</button>
            
            <h3>Category Balancing Rules</h3>
            <div class="info-box">
                Configure rules to prevent listener fatigue and ensure variety
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="color: #ffff00;">Max songs by artist in 24h</label>
                <input type="number" id="maxArtist" value="3" style="width: 100%; margin-bottom: 10px;">
                
                <label style="color: #ffff00;">Max consecutive songs (same category)</label>
                <input type="number" id="maxConsec" value="2" style="width: 100%; margin-bottom: 10px;">
                
                <label style="color: #ffff00;">Minimum gap between songs (minutes)</label>
                <input type="number" id="minGap" value="0" style="width: 100%; margin-bottom: 10px;">
            </div>
            
            <button onclick="autoSchedule24h()">‚ö° Auto-Schedule 24h</button>
            <button onclick="generatePlaylist()" style="background: #4ecdc4;">üìã Generate Playlist</button>
            <button onclick="clearSchedule()" style="background: #ff4444;">Clear Schedule</button>
            
            <h3 style="margin-top: 20px;">Statistics</h3>
            <div class="stats">
                <div class="stat-line">
                    <span>Total Songs:</span>
                    <span class="stat-value" id="totalSongs">0</span>
                </div>
                <div class="stat-line">
                    <span>Duration:</span>
                    <span class="stat-value" id="duration">0h 0m</span>
                </div>
                <div class="stat-line">
                    <span>Categories:</span>
                    <span class="stat-value" id="categories">0</span>
                </div>
                <div class="stat-line">
                    <span>Scheduled:</span>
                    <span class="stat-value" id="scheduled">0</span>
                </div>
            </div>
        </div>
        
        <!-- RIGHT: Up Next & Rules -->
        <div class="card">
            <h2>üìª Queue</h2>
            <div class="queue-list" id="queueList">
                <div class="queue-item" style="text-align: center; color: #888;">No songs loaded</div>
            </div>
            
            <h3 style="margin-top: 20px;">Active Rules</h3>
            <div id="rulesDisplay">
                <div class="rule-item">
                    <strong>Artist Limit:</strong> <span id="rulArtist">3 per day</span>
                </div>
                <div class="rule-item">
                    <strong>Sequence Limit:</strong> <span id="rulSeq">2 consecutive</span>
                </div>
                <div class="rule-item">
                    <strong>Minimum Gap:</strong> <span id="rulGap">0 minutes</span>
                </div>
            </div>
            
            <button onclick="downloadSchedule()" style="margin-top: 20px;">üíæ Download (.m3u)</button>
        </div>
    </div>
    
    <!-- Full Width Features -->
    <div class="grid" style="grid-template-columns: 1fr;">
        <div class="card">
            <h2>üîß Advanced Features</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <div class="info-box" style="border-left-color: #00ff00;">
                    <strong>Smart Rotation</strong><br>
                    Tracks played in past 48h don't play again until cooldown expires
                </div>
                <div class="info-box" style="border-left-color: #ffff00;">
                    <strong>Auto-Fill Gaps</strong><br>
                    Fill gaps in schedule with top-rotation tracks automatically
                </div>
                <div class="info-box" style="border-left-color: #4ecdc4;">
                    <strong>Multi-Category</strong><br>
                    Support music, news, talk shows - with separate rotation rules
                </div>
                <div class="info-box" style="border-left-color: #ff6b6b;">
                    <strong>Hourly Breaks</strong><br>
                    Schedule jingles, news, promos at specific times
                </div>
                <div class="info-box" style="border-left-color: #95e1d3;">
                    <strong>JSON Export</strong><br>
                    Export complete schedule for backup or third-party tools
                </div>
                <div class="info-box" style="border-left-color: #f39c12;">
                    <strong>REST API</strong><br>
                    Control playback via API - perfect for remote stations
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let playlist = [];
    let schedule = [];
    
    function loadPlaylist() {
        const input = document.getElementById('playlistInput').value;
        if (!input.trim()) {
            alert('Please paste M3U/JSON content or load a file');
            return;
        }
        
        playlist = [];
        const lines = input.split('\n');
        
        // Parse M3U format
        for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            if (line.startsWith('#EXTINF:')) {
                const match = line.match(/#EXTINF:([\d.]*)[,\s]*(.+)/);
                if (match) {
                    const duration = parseInt(match[1]) || 180;
                    const title = match[2];
                    const nextLine = lines[i + 1]?.trim();
                    
                    if (nextLine && (nextLine.startsWith('http') || nextLine.startsWith('/'))) {
                        playlist.push({
                            title: title,
                            url: nextLine,
                            duration: duration,
                            category: extractCategory(title)
                        });
                        i++;
                    }
                }
            }
        }
        
        // Parse plain URLs
        const urlRegex = /(https?:\/\/[^\s]+)/g;
        const urls = input.match(urlRegex) || [];
        urls.forEach(url => {
            if (!playlist.some(p => p.url === url)) {
                const title = url.split('/').pop().split('.')[0];
                playlist.push({
                    title: title,
                    url: url,
                    duration: 180,
                    category: 'Music'
                });
            }
        });
        
        updateStats();
        renderQueue();
        alert(`‚úì Loaded ${playlist.length} songs`);
    }
    
    function extractCategory(title) {
        if (title.toLowerCase().includes('news')) return 'News';
        if (title.toLowerCase().includes('talk')) return 'Talk';
        if (title.toLowerCase().includes('promo')) return 'Promo';
        return 'Music';
    }
    
    function updateStats() {
        document.getElementById('totalSongs').textContent = playlist.length;
        const totalMinutes = Math.floor(playlist.reduce((a, b) => a + b.duration, 0) / 60);
        document.getElementById('duration').textContent = Math.floor(totalMinutes / 60) + 'h ' + (totalMinutes % 60) + 'm';
        const categories = new Set(playlist.map(p => p.category)).size;
        document.getElementById('categories').textContent = categories;
    }
    
    function renderQueue() {
        const qList = document.getElementById('queueList');
        qList.innerHTML = playlist.slice(0, 10).map((song, idx) => 
            `<div class="queue-item">${idx + 1}. ${song.title}</div>`
        ).join('');
    }
    
    function autoSchedule24h() {
        if (playlist.length === 0) {
            alert('No songs loaded');
            return;
        }
        schedule = [];
        const needed = 1440; // minutes in 24h
        let elapsed = 0;
        let idx = 0;
        
        while (elapsed < needed && idx < playlist.length * 10) {
            const song = playlist[idx % playlist.length];
            schedule.push(song);
            elapsed += song.duration / 60;
            idx++;
        }
        
        document.getElementById('scheduled').textContent = schedule.length;
        alert(`‚úì Scheduled ${schedule.length} songs for 24 hours`);
    }
    
    function generatePlaylist() {
        if (schedule.length === 0) {
            alert('No schedule created. Click Auto-Schedule first.');
            return;
        }
        
        let m3u = '#EXTM3U\n';
        schedule.forEach(song => {
            m3u += `#EXTINF:${song.duration},${song.title}\n${song.url}\n`;
        });
        
        const el = document.createElement('a');
        el.href = 'data:text/plain,' + encodeURIComponent(m3u);
        el.download = `radio_schedule_${new Date().toISOString().slice(0, 10)}.m3u`;
        el.click();
    }
    
    function downloadSchedule() {
        generatePlaylist();
    }
    
    function clearSchedule() {
        playlist = [];
        schedule = [];
        document.getElementById('playlistInput').value = '';
        document.getElementById('queueList').innerHTML = '<div class="queue-item" style="text-align: center; color: #888;">No songs loaded</div>';
        updateStats();
    }
    
    // Update rules display on input change
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('maxArtist')?.addEventListener('change', () => {
            document.getElementById('rulArtist').textContent = document.getElementById('maxArtist').value + ' per day';
        });
    });
</script>

</body>
</html>
