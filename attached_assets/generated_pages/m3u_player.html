<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScheduleFlow M3U Player</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #000000 0%, #000000 50%, #000000 100%);
            color: #fff;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        .playlist {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
            max-height: 600px;
            overflow-y: auto;
        }
        .playlist h3 {
            margin-bottom: 15px;
            color: #ff6b35;
        }
        .channel-item {
            padding: 10px;
            margin-bottom: 8px;
            background: #333;
            border: 1px solid #444;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .channel-item:hover {
            background: #ff6b35;
            color: #000;
            border-color: #ff6b35;
        }
        .channel-item.active {
            background: #ff6b35;
            color: #000;
            font-weight: bold;
            border-color: #ff6b35;
        }
        .channel-name {
            flex: 1;
        }
        .channel-index {
            font-size: 12px;
            opacity: 0.7;
        }
        .player-container {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        .player-header {
            color: #ff6b35;
            margin-bottom: 15px;
            font-size: 14px;
        }
        .player-info {
            background: #333;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            min-height: 30px;
        }
        .player-info h2 {
            color: #ff6b35;
            font-size: 18px;
            margin-bottom: 5px;
        }
        .player-info p {
            font-size: 12px;
            color: #aaa;
        }
        video {
            width: 100%;
            aspect-ratio: 16/9;
            background: #000;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .controls {
            display: flex;
            gap: 10px;
        }
        button {
            flex: 1;
            padding: 10px;
            background: #ff6b35;
            color: #000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }
        button:hover {
            background: #ff8a52;
        }
        button:active {
            transform: scale(0.98);
        }
        .upload-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #444;
        }
        input[type="file"] {
            color: #fff;
            width: 100%;
            padding: 8px;
            background: #333;
            border: 1px solid #444;
            border-radius: 4px;
            cursor: pointer;
        }
        .status {
            font-size: 12px;
            color: #888;
            margin-top: 10px;
        }
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            .playlist {
                max-height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="playlist">
            <h3>üì∫ M3U Playlist</h3>
            <div class="upload-section">
                <input type="file" id="m3uFile" accept=".m3u,.m3u8" placeholder="Load M3U file">
                <div class="status" id="status">Ready</div>
            </div>
            <div id="channelList"></div>
        </div>
        
        <div class="player-container">
            <div class="player-header">Live Channel Player</div>
            <div class="player-info">
                <h2 id="channelTitle">Select a channel</h2>
                <p id="channelUrl"></p>
            </div>
            <video id="player" controls></video>
            <div class="controls">
                <button onclick="previousChannel()">‚Üê Previous</button>
                <button onclick="playSelected()">‚ñ∂ Play</button>
                <button onclick="nextChannel()">Next ‚Üí</button>
            </div>
        </div>
    </div>

    <script>
        let playlist = [];
        let currentIndex = 0;

        // Load default M3U on start
        async function loadDefaultPlaylist() {
            try {
                const response = await fetch('scheduleflow_live.m3u');
                const text = await response.text();
                parseM3U(text);
                document.getElementById('status').textContent = `‚úÖ Loaded ${playlist.length} channels`;
            } catch (e) {
                document.getElementById('status').textContent = `Error loading default playlist`;
            }
        }

        function parseM3U(content) {
            playlist = [];
            const lines = content.split('\n');
            let i = 0;
            while (i < lines.length) {
                const line = lines[i].trim();
                if (line.startsWith('#EXTINF:')) {
                    const name = line.substring(line.lastIndexOf(',') + 1);
                    const url = lines[i + 1]?.trim();
                    if (url && url.startsWith('http')) {
                        playlist.push({ name, url });
                    }
                    i += 2;
                } else {
                    i++;
                }
            }
            renderPlaylist();
        }

        function renderPlaylist() {
            const list = document.getElementById('channelList');
            list.innerHTML = '';
            playlist.forEach((ch, idx) => {
                const div = document.createElement('div');
                div.className = `channel-item ${idx === currentIndex ? 'active' : ''}`;
                div.innerHTML = `<span class="channel-name">${ch.name}</span><span class="channel-index">#${idx + 1}</span>`;
                div.onclick = () => { currentIndex = idx; renderPlaylist(); selectChannel(); };
                list.appendChild(div);
            });
        }

        function selectChannel() {
            if (playlist[currentIndex]) {
                const ch = playlist[currentIndex];
                document.getElementById('channelTitle').textContent = ch.name;
                document.getElementById('channelUrl').textContent = ch.url;
                renderPlaylist();
            }
        }

        function playSelected() {
            if (playlist[currentIndex]) {
                const ch = playlist[currentIndex];
                const player = document.getElementById('player');
                player.src = ch.url;
                player.play();
            }
        }

        function nextChannel() {
            currentIndex = (currentIndex + 1) % playlist.length;
            selectChannel();
        }

        function previousChannel() {
            currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
            selectChannel();
        }

        // File upload handler
        document.getElementById('m3uFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    parseM3U(event.target.result);
                    document.getElementById('status').textContent = `‚úÖ Loaded ${playlist.length} channels`;
                    selectChannel();
                };
                reader.readAsText(file);
            }
        });

        // Load on start
        document.addEventListener('DOMContentLoaded', () => {
            loadDefaultPlaylist();
            if (playlist.length > 0) selectChannel();
        });

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextChannel();
            if (e.key === 'ArrowLeft') previousChannel();
            if (e.key === ' ') { e.preventDefault(); playSelected(); }
        });
    </script>
</body>
</html>
