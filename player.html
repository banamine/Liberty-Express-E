<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/base.css">
<title>ScheduleFlow - Ultimate Player</title>
<style>
* {margin:0;padding:0;box-sizing:border-box;}
html,body {height:100%;overflow:hidden;background:#000;font-family:Segoe UI,Tahoma,sans-serif;}
#player {position:relative;width:100vw;height:100vh;}

#top {position:absolute;top:0;left:0;right:0;z-index:20;background:rgba(0,0,0,.88);border-bottom:2px solid #00ff00;
      padding:14px 20px;min-height:78px;backdrop-filter:blur(10px);
      display:grid;grid-template-columns:1fr auto 1fr;align-items:start;color:#ffff00;
      transition:all .35s;pointer-events:none;}
#top * {pointer-events:auto;}
#top:hover {padding:20px 20px;min-height:100px;}

.now-title {font-weight:bold;font-size:1.1em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:font-size .3s;}
#top:hover .now-title {font-size:1.35em;}
.now-times {display:grid;grid-template-columns:auto auto;gap:18px;margin-top:6px;font-size:.9em;opacity:.9;transition:all .3s;}
#top:hover .now-times {font-size:1.05em;gap:24px;}

.mid {display:flex;gap:16px;align-self:center;opacity:0;transition:opacity .4s;}
#top:hover .mid {opacity:1;}
#top button {background:rgba(0,255,0,.2);color:#00ff00;border:2px solid #00ff00;border-radius:4px;padding:10px 16px;cursor:pointer;font-size:.95em;font-weight:bold;transition:.2s;}
#top button:hover {background:rgba(0,255,0,.4);box-shadow:0 0 10px #00ff00;}

.next-title {font-style:italic;color:#00ccff;font-size:1.05em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:font-size .3s;}
#top:hover .next-title {font-size:1.25em;}
.next-time {margin-top:6px;font-size:.9em;opacity:.9;transition:font-size .3s;}
#top:hover .next-time {font-size:1.05em;}

#fs {position:absolute;bottom:18px;right:18px;z-index:11;background:rgba(0,0,0,.7);color:#00ff00;border:2px solid #00ff00;padding:10px 14px;border-radius:4px;cursor:pointer;opacity:0;transition:.3s;font-weight:bold;}
#player:hover #fs {opacity:1;}
#fs:hover {background:rgba(0,255,0,.2);box-shadow:0 0 10px #00ff00;}

video {width:100%;height:100%;object-fit:contain;background:#000;}

#left {position:absolute;top:0;bottom:0;left:0;width:340px;background:rgba(0,0,30,.97);border-right:2px solid #00ff00;padding:20px;overflow-y:auto;z-index:30;transform:translateX(-110%);transition:.35s;}
#left.on {transform:translateX(0);}
.close-btn {position:absolute;top:12px;right:12px;background:none;border:2px solid #00ff00;color:#00ff00;padding:8px 14px;cursor:pointer;border-radius:4px;font-weight:bold;}
.close-btn:hover {background:rgba(0,255,0,.2);}
.pitem {padding:11px;background:rgba(0,255,0,.05);border:1px solid #00ff00;border-radius:4px;cursor:pointer;color:#fff;margin:6px 0;transition:.2s;}
.pitem:hover {background:rgba(0,255,0,.15);border-color:#ffff00;}
.pitem.active {background:rgba(0,255,0,.25);border-color:#ffff00;color:#ffff00;font-weight:bold;}

.sidebar-title {color:#ffff00;font-weight:bold;margin-bottom:1rem;border-bottom:1px solid #00ff00;padding-bottom:0.5rem;}

::-webkit-scrollbar {width:10px;}
::-webkit-scrollbar-track {background:rgba(0,255,0,.05);}
::-webkit-scrollbar-thumb {background:#00ff00;border-radius:5px;}
::-webkit-scrollbar-thumb:hover {background:#ffff00;}
</style>
</head>
<body>
    <div id="app-clock" class="nav-clock" style="position: fixed; bottom: 85px; right: 20px; z-index: 1000; color: #00ff00; font-family: 'Courier New', monospace; font-weight: bold;">--:--:--</div>
    <nav class="breadcrumb-nav"></nav>

<div id="player">
  <div id="top">
    <div class="now">
      <div class="now-title" id="title">Loading station…</div>
      <div class="now-times">
        <span>Played: <span id="played">00:00</span></span>
        <span>Ends: <span id="ends">--:--</span></span>
      </div>
    </div>

    <div class="mid">
      <button id="prev">◄ Prev</button>
      <button id="list">☰ Playlist</button>
      <button id="next">Next ►</button>
    </div>

    <div style="text-align:right">
      <div class="next-title">Next: <span id="next-title">—</span></div>
      <div class="next-time">Starts: <span id="starts">--:--</span></div>
    </div>
  </div>

  <button id="fs">Full Screen</button>
  <video id="vid" playsinline autoplay controls></video>

  <div id="left">
    <button class="close-btn" onclick="toggleLeft()">✕ Close</button>
    <div class="sidebar-title">📺 Playlist</div>
    <div id="plist"></div>
  </div>
</div>

<script>
const playlist = {{ playlist | tojson }} || [];

const vid = document.getElementById('vid');
const title = document.getElementById('title');
const played = document.getElementById('played');
const ends = document.getElementById('ends');
const nextTitle = document.getElementById('next-title');
const starts = document.getElementById('starts');
const plist = document.getElementById('plist');
let idx = 0;
let playedSet = new Set();
let nextIdx = null;

const fmt = s => `${Math.floor(s/60).toString().padStart(2,'0')}:${Math.floor(s%60).toString().padStart(2,'0')}`;
const clock = d => {
  let h = d.getHours(), m = d.getMinutes(), a = h >= 12 ? 'PM' : 'AM';
  h = h % 12 || 12; m = m < 10 ? '0' + m : m;
  return `${h}:${m} ${a}`;
};

function buildPlaylist() {
  console.log("Building playlist with " + playlist.length + " items");
  let html = '';
  playlist.forEach((ep, i) => {
    html += `<div class="pitem" data-i="${i}" onclick="selectItem(${i})">${ep.title || ep.name || 'Unknown'}</div>`;
  });
  plist.innerHTML = html || '<div style="color:#999;padding:1rem;">No items loaded</div>';
}

function selectItem(i) {
  idx = i;
  loadVideo(idx);
  toggleLeft();
}

function pickNext() {
  if (playlist.length === 0) return;
  if (playedSet.size >= playlist.length) playedSet.clear();
  do { nextIdx = Math.floor(Math.random() * playlist.length); }
  while (playedSet.has(nextIdx) && playlist.length > 1 && nextIdx === idx);
  playedSet.add(nextIdx);
  if (nextIdx < playlist.length) {
    nextTitle.textContent = (playlist[nextIdx].title || playlist[nextIdx].name || 'Unknown').substring(0, 40);
  }
}

function updateClocks() {
  played.textContent = fmt(vid.currentTime);
  const left = vid.duration - vid.currentTime;
  if (isFinite(left)) {
    const end = new Date(Date.now() + left * 1000);
    ends.textContent = clock(end);
    starts.textContent = clock(end);
  }
}

function loadVideo(i) {
  if (i >= playlist.length || i < 0) return;
  const ep = playlist[i];
  idx = i;
  title.textContent = (ep.title || ep.name || 'Unknown').substring(0, 60);
  vid.src = ep.url || ep.source || '';
  vid.load();
  console.log("Loading: " + title.textContent);

  vid.onloadeddata = () => {
    vid.play();
    pickNext();
  };
  vid.ontimeupdate = updateClocks;
  vid.onended = () => {
    if (nextIdx !== null && nextIdx < playlist.length) {
      loadVideo(nextIdx);
    }
  };

  document.querySelectorAll('.pitem').forEach(el =>
    el.classList.toggle('active', parseInt(el.dataset.i) === i)
  );
}

function toggleLeft() {
  document.getElementById('left').classList.toggle('on');
}

document.getElementById('prev').onclick = () => {
  loadVideo(idx - 1 < 0 ? playlist.length - 1 : idx - 1);
};
document.getElementById('next').onclick = () => {
  if (nextIdx !== null) loadVideo(nextIdx);
};
document.getElementById('list').onclick = toggleLeft;
document.getElementById('fs').onclick = () => {
  vid.requestFullscreen?.() || vid.webkitEnterFullscreen?.();
};

console.log("Ultimate Player booting…");
buildPlaylist();
if (playlist.length > 0) {
  loadVideo(Math.floor(Math.random() * playlist.length));
} else {
  title.textContent = 'No playlist data loaded';
}
</script>
    <script src="/static/js/breadcrumbs.js"></script>
    <script src="/static/js/app-base.js"></script>
<script src="/static/js/file-manager.js"></script>
</body>
</html>
<!-- Updated 11/24/2025 16:15:28 -->
